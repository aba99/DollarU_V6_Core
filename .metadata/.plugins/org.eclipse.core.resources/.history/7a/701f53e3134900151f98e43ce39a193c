package com.orsyp.client.amex;

import java.util.Vector;

import com.orsyp.api.Variable;

public class CabrinProcess {
	//this class represents the process that gets triggered when a file is dropped
	//the info that it contains is :
	//			1- full file name
	//			2- googleNumber
	//			3- MainJob it triggers
	//			4- variables are the uproc variables to pass on to the CARBIN uproc
	private String fileName;
	private String googleNumber;
	private String relatedMainJob;
	private Vector<Variable> variables;
	
	public CabrinProcess(String filename,String mainjobname)
	{
		fileName=filename;
		relatedMainJob=mainjobname;
		googleNumber =getGoogleNumber(filename);
		
		
	}
	public String getFullFileName()
	{
		return fileName;
	}
	public String getGNumber()
	{
		return googleNumber;
	}
	public String getMainJob()
	{
		return relatedMainJob;
	}
	public void setFullFileName(String fname)
	{
		fileName=fname;
	}
	public void setGNumber(String gnumber)
	{
		googleNumber=gnumber;
	}
	public void setRelatedMainJob(String relatedMJ )
	{
		relatedMainJob=relatedMJ;
	}
	public void setUprVariables()
	{
		
	}
	public static String getGoogleNumber(String fullFilename)
	{// *.G0000V00.TRIGGER needs to be parsed
		fullFilename=fullFilename.replace(".TRIGGER","");
		int length= fullFilename.length();
		
		
		fullFilename=fullFilename.substring(length-8, length);
		return fullFilename.substring(3, 5);
		
	}
	private static Vector<Variable> deriveUprocVariables()
	{
		Vector<Variable> varia= new Vector<Variable>();
	
		Variable var_1 = new Variable();
		
		
	
	if(varia.size()==3 && varia.get(1).getName().equals("COMMAND_PART2") 
					   && varia.get(2).getName().equals("MAIN_JOB_TRIGGER")
					   && !board.containsKey(upr.getName()) )
	{	

		System.out.println("Updating \"COMMAND_PART2\" on UPR <"+upr.getName()+"> with #G ="+googleNumber);
		System.out.println("Updating \"MAIN_JOB_TRIGGER\" on UPR <"+upr.getName()+"> with \""+mainjob+"\"");

			String command =varia.get(1).getValue();
			command=command.replace("-S00", "-S"+googleNumber);
			command=command.replace("<FILE>", file);
			varia.get(1).setValue(command);	
		
			
			String main_job_trigger = varia.get(2).getValue();
			main_job_trigger=main_job_trigger.replace("<JOB>", mainjob);
			varia.get(2).setValue(main_job_trigger);
			
			
			upr.setVariables(varia);	
			upr.update();
	
	}
	if(varia.size()==3 && varia.get(1).getName().equals("COMMAND_PART2") && board.containsKey(upr.getName()) )
	{
		String command =varia.get(1).getValue();
		System.out.println("Updating \"COMMAND_PART2\" on UPR <"+upr.getName()+"> with #G ="+googleNumber);
		command=command.replace("-S"+board.get(upr.getName()), "-S"+googleNumber);
		command=command.replace("G00"+board.get(upr.getName()), "G00"+googleNumber);
		//assumes constant file for job. Each job is triggered by the same unique file 
		varia.get(1).setValue(command);	
		upr.setVariables(varia);	
		upr.update();
		
	}
	
	
	
	
	
	
	
	
	
	
	
	
}
